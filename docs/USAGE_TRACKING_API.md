# æ‡‰ç”¨æƒ…å¢ƒåœç•™ API ä½¿ç”¨èªªæ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”èªªæ˜å¦‚ä½•ä½¿ç”¨æ‡‰ç”¨æƒ…å¢ƒåœç•™ API ä¾†è¿½è¹¤ç”¨æˆ¶åœ¨æ™ºæ…§å½±éŸ³ç”Ÿæˆæ¨¡çµ„ä¸­çš„ä½¿ç”¨æƒ…æ³ã€‚

## ğŸ”— API ç«¯é»

```
POST https://rise.iii.org.tw/app_restful/public/index.php/api/customers/add/2
```

## ğŸ“Š åƒæ•¸èªªæ˜

### å¿…å¡«åƒæ•¸

| åƒæ•¸åç¨± | ä¸­æ–‡åç¨± | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|---------|---------|------|------|------|
| `mode` | è³‡æ–™é¡åˆ¥ | varchar(10) | å›ºå®šåƒæ•¸å€¼è¨­å®šç‚º 2 | `"2"` |
| `app_id` | è­˜åˆ¥ç¢¼ | varchar(100) | å›ºå®šå›å‚³ "114_å…‰éš¼" | `"114_å…‰éš¼"` |
| `action_id` | æƒ…å¢ƒç¨®é¡ | varchar(100) | æƒ…å¢ƒç¨®é¡ï¼Œå›ºå®šå›å‚³ï¼Œä¾‹å¦‚ï¼šæ–°å¢åˆ†é æˆ–é›¢é–‹é é¢ | `"ai_audio_step1"` |
| `action_name` | æƒ…å¢ƒæè¿° | varchar(100) | æƒ…å¢ƒæè¿°ï¼Œå›ºå®šå›å‚³ï¼Œä¾‹å¦‚ï¼šé¦–é ã€ä¸»é¡Œé ï¼ˆä¸»é¡Œï¼‰ã€æœå°‹çµæœé ï¼ˆæœå°‹ï¼‰... | `"åŸºæœ¬è³‡è¨Š"` |
| `use_time` | ç¸½ä½¿ç”¨æ™‚é–“ | varchar(100) | å¾ä½¿ç”¨è€…é€²å…¥æ­¤é é¢è‡³ä»Šï¼Œé é¢æ‰€åœç•™ç§’æ•¸ | `"0"` |
| `time` | è³‡æ–™å‚³é€æ™‚é–“ | int(11) | Unix timestamp, å¾ 1970å¹´1æœˆ1æ—¥0æ™‚0åˆ†0ç§’èµ·è‡³ç¾åœ¨çš„ç¸½ç§’æ•¸ | `1704700800` |
| `device_id` | å”¯ä¸€è­˜åˆ¥ç¢¼ | varchar(100) | å”¯ä¸€è­˜åˆ¥ç¢¼ï¼Œå¯å‚³æœƒå“¡ IDã€å¸³è™Ÿç­‰å¯å€åˆ†æœƒå“¡ä¹‹å€¼å³å¯ | `"91"` |
| `ip` | ä½¿ç”¨è€… IP | varchar(100) | å›å‚³ä½¿ç”¨è€…çš„ IPï¼Œä¾‹ï¼š111.111.111.111 | `"192.168.1.1"` |
| `view` | ä½¿ç”¨æ‰‹æ©Ÿæˆ–é›»è…¦ | varchar(10) | å›å‚³æ­¤ API æ™‚ä½¿ç”¨æ‰‹æ©Ÿæˆ–é›»è…¦ï¼Œè‹¥æ˜¯æ‰‹æ©Ÿå›å‚³ phoneï¼Œæ˜¯é›»è…¦å‰‡å›å‚³ PC | `"phone"` æˆ– `"PC"` |
| `now_page` | ç¾åœ¨çš„é é¢ | varchar(10) | ä¾ç…§ä¾‹å¦‚ï¼šé¦–é ã€ä¸»é¡Œé ã€æœå°‹éæ¿¾é¸å–®ã€æœå°‹çµæœé ã€ç”¢å“ç´°ç¯€é ã€ä¸‹å–®é æˆ–çµå¸³é  | `"åŸºæœ¬è³‡è¨Š"` |

## ğŸ¯ å·²å¯¦æ–½åŠŸèƒ½

### 1. éŸ³é »å‰µä½œè¿½è¹¤ (`Audio.tsx`)

è¿½è¹¤ç”¨æˆ¶åœ¨éŸ³é »å‰µä½œæµç¨‹ä¸­çš„æ­¥é©Ÿåˆ‡æ›ï¼š

| æ­¥é©Ÿ | action_id | action_name | now_page |
|-----|-----------|-------------|----------|
| 1 | `ai_audio_step1` | åŸºæœ¬è³‡è¨Š | åŸºæœ¬è³‡è¨Š |
| 2 | `ai_audio_step2` | èªéŸ³æ¨¡å‹ | èªéŸ³æ¨¡å‹ |
| 3 | `ai_audio_step3` | æƒ…ç·’èª¿æ•´ | æƒ…ç·’èª¿æ•´ |
| 4 | `ai_audio_step4` | æ–‡æ¡ˆç·¨è¼¯ | æ–‡æ¡ˆç·¨è¼¯ |
| 5 | `ai_audio_step5` | AIç”Ÿæˆ | AIç”Ÿæˆ |

**å¯¦æ–½ä½ç½®**ï¼šæ¯æ¬¡ç”¨æˆ¶é»æ“Šã€Œä¸‹ä¸€æ­¥ã€æŒ‰éˆ•æ™‚è‡ªå‹•è¿½è¹¤

### 2. å½±ç‰‡å‰µä½œè¿½è¹¤ (`VideoCreation.tsx`)

è¿½è¹¤ç”¨æˆ¶åœ¨å½±ç‰‡å‰µä½œæµç¨‹ä¸­çš„æ­¥é©Ÿåˆ‡æ›ï¼š

| æ­¥é©Ÿ | action_id | action_name | now_page |
|-----|-----------|-------------|----------|
| 1 | `video_creation_step1` | å½±ç‰‡æ¨™é¡Œ | åŸºæœ¬è³‡è¨Š |
| 2 | `video_creation_step2` | èªéŸ³æ¨¡å‹ | èªéŸ³æ¨¡å‹ |
| 3 | `video_creation_step3` | é¸æ“‡ç´ æ | å½±åƒç´ æ |
| 4 | `video_creation_step4` | å½±ç‰‡æƒ…å¢ƒ | å½±ç‰‡æƒ…å¢ƒæè¿° |
| 5 | `video_creation_step5` | ç”Ÿæˆå½±ç‰‡ | AIç”Ÿæˆ |

**å¯¦æ–½ä½ç½®**ï¼šæ¯æ¬¡ç”¨æˆ¶é»æ“Šã€Œä¸‹ä¸€æ­¥ã€æŒ‰éˆ•æ™‚è‡ªå‹•è¿½è¹¤

## ğŸ’» ç¨‹å¼ç¢¼ä½¿ç”¨ç¯„ä¾‹

### åŸºæœ¬ä½¿ç”¨

```typescript
import { trackUsage } from '../services/usageTracking';

// è¿½è¹¤è‡ªå®šç¾©äº‹ä»¶
await trackUsage({
  action_id: 'custom_action',
  action_name: 'è‡ªå®šç¾©æ“ä½œ',
  now_page: 'ç•¶å‰é é¢',
  use_time: '60'  // å¯é¸ï¼Œé è¨­ç‚º "0"
});
```

### éŸ³é »å‰µä½œæ­¥é©Ÿè¿½è¹¤

```typescript
import { trackAudioStep } from '../services/usageTracking';

// è¿½è¹¤éŸ³é »å‰µä½œç¬¬1æ­¥
await trackAudioStep(1);
```

### å½±ç‰‡å‰µä½œæ­¥é©Ÿè¿½è¹¤

```typescript
import { trackVideoCreationStep } from '../services/usageTracking';

// è¿½è¹¤å½±ç‰‡å‰µä½œç¬¬3æ­¥
await trackVideoCreationStep(3);
```

### é é¢è¨ªå•è¿½è¹¤

```typescript
import { trackPageVisit } from '../services/usageTracking';

// è¿½è¹¤é é¢è¨ªå•
await trackPageVisit('è¨­å®šé é¢');
```

## ğŸ“ API è«‹æ±‚ç¯„ä¾‹

### è«‹æ±‚æ ¼å¼

```http
POST https://rise.iii.org.tw/app_restful/public/index.php/api/customers/add/2
Content-Type: application/x-www-form-urlencoded

mode=2&app_id=114_%E5%85%89%E9%9A%BC&action_id=ai_audio_step1&action_name=%E5%9F%BA%E6%9C%AC%E8%B3%87%E8%A8%8A&use_time=0&time=1704700800&device_id=91&ip=192.168.1.1&view=phone&now_page=%E5%9F%BA%E6%9C%AC%E8%B3%87%E8%A8%8A
```

### æˆåŠŸå›æ‡‰

```json
{
  "status": "success",
  "message": "Customer Added 2"
}
```

- **Status Code**: 200

### å¤±æ•—å›æ‡‰

```json
{
  "status": "error",
  "message": "éŒ¯èª¤è¨Šæ¯"
}
```

- **Status Code**: 400 æˆ–å…¶ä»–éŒ¯èª¤ä»£ç¢¼

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### æœå‹™æª”æ¡ˆï¼š`src/services/usageTracking.ts`

é€™å€‹æœå‹™æä¾›äº†çµ±ä¸€çš„è¿½è¹¤åŠŸèƒ½ï¼š

- âœ… è‡ªå‹•å¾ `localStorage` ç²å–ç”¨æˆ¶è³‡è¨Š
- âœ… è‡ªå‹•åˆ¤æ–·è¨­å‚™é¡å‹ï¼ˆæ‰‹æ©Ÿ/é›»è…¦ï¼‰
- âœ… è‡ªå‹•ç”Ÿæˆ Unix timestamp
- âœ… è™•ç† URL-encoded æ ¼å¼è½‰æ›
- âœ… éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„

### å·²æ•´åˆé é¢

1. âœ… **éŸ³é »å‰µä½œ** (`src/pages/Audio.tsx`)
   - åœ¨ `handleNextStep` å‡½æ•¸ä¸­èª¿ç”¨ `trackAudioStep()`
   
2. âœ… **å½±ç‰‡å‰µä½œ** (`src/pages/VideoCreation.tsx`)
   - åœ¨ `handleNextStep` å‡½æ•¸ä¸­èª¿ç”¨ `trackVideoCreationStep()`

## ğŸ“ˆ è³‡æ–™æµç¨‹

```
ç”¨æˆ¶æ“ä½œ â†’ è§¸ç™¼æ­¥é©Ÿåˆ‡æ› â†’ èª¿ç”¨è¿½è¹¤å‡½æ•¸ â†’ çµ„è£åƒæ•¸ â†’ ç™¼é€ API è«‹æ±‚ â†’ è¨˜éŒ„æ—¥èªŒ
```

## ğŸ¨ æœ€ä½³å¯¦è¸

### 1. ä½•æ™‚è¿½è¹¤ï¼Ÿ

- âœ… ç”¨æˆ¶å®Œæˆé‡è¦æ“ä½œæ™‚
- âœ… ç”¨æˆ¶åˆ‡æ›æ­¥é©Ÿæ™‚
- âœ… ç”¨æˆ¶é€²å…¥æ–°é é¢æ™‚
- âŒ ä¸è¦åœ¨æ¯å€‹å°å‹•ä½œéƒ½è¿½è¹¤ï¼ˆé¿å…éå¤šè«‹æ±‚ï¼‰

### 2. å‘½åè¦ç¯„

- `action_id`: ä½¿ç”¨å°å¯«è‹±æ–‡å’Œåº•ç·šï¼Œä¾‹å¦‚ï¼š`ai_audio_step1`
- `action_name`: ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œç°¡æ½”æ˜ç­
- `now_page`: ä½¿ç”¨ä¸­æ–‡é é¢åç¨±

### 3. éŒ¯èª¤è™•ç†

è¿½è¹¤å‡½æ•¸å·²ç¶“åŒ…å«éŒ¯èª¤è™•ç†ï¼Œä¸æœƒå½±éŸ¿ä¸»è¦åŠŸèƒ½æµç¨‹ï¼š

```typescript
try {
  await trackAudioStep(nextStep);
} catch (error) {
  // éŒ¯èª¤æœƒè¢«å…§éƒ¨æ•ç²ï¼Œä¸å½±éŸ¿ç”¨æˆ¶æ“ä½œ
  console.error('è¿½è¹¤å¤±æ•—:', error);
}
```

## ğŸ› é™¤éŒ¯æ–¹å¼

### 1. æª¢æŸ¥ Console æ—¥èªŒ

åœ¨ç€è¦½å™¨é–‹ç™¼å·¥å…·çš„ Console ä¸­æŸ¥çœ‹ï¼š

```
ä½¿ç”¨æƒ…å¢ƒè¿½è¹¤ API å›æ‡‰: {"status":"success","message":"Customer Added 2"}
```

### 2. æª¢æŸ¥ Network è«‹æ±‚

åœ¨ Network æ¨™ç±¤ä¸­ç¯©é¸ `rise.iii.org.tw` è«‹æ±‚ï¼ŒæŸ¥çœ‹ï¼š
- è«‹æ±‚åƒæ•¸æ˜¯å¦æ­£ç¢º
- å›æ‡‰ç‹€æ…‹ç¢¼
- å›æ‡‰å…§å®¹

### 3. æª¢æŸ¥ç”¨æˆ¶è³‡è¨Š

ç¢ºèª `localStorage` ä¸­æœ‰ç”¨æˆ¶è³‡è¨Šï¼š

```javascript
const user = JSON.parse(localStorage.getItem('user'));
console.log('ç”¨æˆ¶ ID:', user.id);
console.log('ç”¨æˆ¶ IP:', user.ip_address);
```

## ğŸ“ è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œæˆ–éœ€è¦å”åŠ©ï¼Œè«‹è¯ç¹«ï¼š
- é™é—œè³‡æ–™
- ç‰ˆæ¬Šæ‰€æœ‰
- ç¿»å°å¿…ç©¶

---

**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2025-01-07
**ç¶­è­·è€…**: è³‡ç­–æœƒæ•¸ä½ç ”ç™¼éƒ¨ FIND åœ˜éšŠç®¡ç†

